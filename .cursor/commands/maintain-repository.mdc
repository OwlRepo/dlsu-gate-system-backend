---
alwaysApply: true
---

# Maintain Repository Workflow

Use this workflow for regular repository maintenance to keep the codebase up-to-date and working.

## Related Rules

This command automatically applies the following rules:

### Core Rules (Always Apply)

- **coding-practice.mdc** - Code style and standards
- **debugging-practice.mdc** - Error handling

### Task-Specific Rules (Context-Dependent)

- **dependency-management.mdc** - For package updates
- **database-migrations.mdc** - For migration checks
- **documentation-patterns.mdc** - For documentation updates

## Step 1: Check Package Status

**Applies Rules:** dependency-management.mdc

1. **Check Outdated Packages**

   ```bash
   npm outdated
   ```

   - Review outdated packages
   - Identify security vulnerabilities
   - Note packages needing updates

2. **Check Security Vulnerabilities**

   ```bash
   npm audit
   ```

   - Review security issues
   - Prioritize critical vulnerabilities
   - Plan security updates

3. **Review Dependency Tree**

   ```bash
   npm ls --depth=0
   ```

   - Check for duplicate packages
   - Identify unused dependencies
   - Review dependency conflicts

## Step 2: Check Database Migrations

**Applies Rules:** database-migrations.mdc

1. **Check Migration Status**

   ```bash
   npm run typeorm -- migration:show -d src/config/data-source.ts
   ```

   - Verify all migrations are applied
   - Check for pending migrations
   - Review migration history

2. **Verify Database Schema**
   - Compare entities with database schema
   - Check for drift between code and database
   - Identify missing migrations

## Step 3: Code Quality Checks

**Applies Rules:** coding-practice.mdc, debugging-practice.mdc

1. **Run Linter**

   ```bash
   npm run lint
   ```

   - Fix linting errors
   - Ensure code style consistency
   - Follow coding-practice.mdc

2. **Format Code**

   ```bash
   npm run format
   ```

   - Ensure consistent formatting
   - Follow project formatting rules

3. **Type Check**

   ```bash
   npm run build
   ```

   - Verify TypeScript compilation
   - Fix type errors
   - Ensure type safety

## Step 4: Run Tests

**Applies Rules:** debugging-practice.mdc

1. **Run Unit Tests**

   ```bash
   npm test
   ```

   - Ensure all tests pass
   - Fix failing tests
   - Review test coverage

2. **Run E2E Tests** (if applicable)

   ```bash
   npm run test:e2e
   ```

   - Verify integration tests
   - Check critical flows

## Step 5: Update Dependencies (if needed)

**Applies Rules:** dependency-management.mdc

1. **Update Security Vulnerabilities**

   ```bash
   npm audit fix
   ```

   - Fix security issues
   - Test after updates

2. **Update Patch Versions**

   ```bash
   npm update
   ```

   - Update within version ranges
   - Test after updates

3. **Follow update-packages.mdc** for major updates

## Step 6: Verify Application Works

**Applies Rules:** debugging-practice.mdc

1. **Build Application**

   ```bash
   npm run build
   ```

   - Verify build succeeds
   - Check for compilation errors

2. **Start Application**

   ```bash
   npm run dev
   ```

   - Verify application starts
   - Check for runtime errors
   - Test critical endpoints

3. **Check Logs**
   - Review application logs
   - Check for warnings
   - Verify no errors

## Step 7: Update Documentation

**Applies Rules:** documentation-patterns.mdc

1. **Run document-changes Command**
   - Update context files
   - Refresh documentation
   - Update recent changes

2. **Review Documentation**
   - Check API documentation
   - Verify feature docs
   - Update if needed

## Step 8: Clean Up

**Applies Rules:** coding-practice.mdc

1. **Remove Unused Files**
   - Delete temporary files
   - Remove commented code
   - Clean up test files

2. **Remove Unused Dependencies**

   ```bash
   npm uninstall unused-package
   ```

   - Remove unused packages
   - Clean up imports
   - Update package.json

3. **Clean Build Artifacts**

   ```bash
   rm -rf dist
   npm run build
   ```

   - Fresh build
   - Verify build artifacts

## Step 9: Git Maintenance

**Applies Rules:** coding-practice.mdc

1. **Review Git Status**

   ```bash
   git status
   ```

   - Check for uncommitted changes
   - Review modified files
   - Identify untracked files

2. **Commit Changes**
   - Commit maintenance updates
   - Use clear commit messages
   - Follow commit conventions

3. **Review Git History**
   - Check recent commits
   - Verify commit messages
   - Review branch status

## Step 10: Maintenance Checklist

- [ ] Packages checked for updates
- [ ] Security vulnerabilities reviewed
- [ ] Migrations verified
- [ ] Code linted and formatted
- [ ] TypeScript compilation successful
- [ ] All tests passing
- [ ] Application builds successfully
- [ ] Application runs without errors
- [ ] Documentation updated
- [ ] Unused code/files removed
- [ ] Unused dependencies removed
- [ ] Git status clean
- [ ] Changes committed

## Regular Maintenance Schedule

### Daily

- Check for critical security updates
- Verify application is running
- Review error logs

### Weekly

- Check outdated packages
- Run tests
- Review code quality

### Monthly

- Update patch versions
- Review and update dependencies
- Full maintenance workflow
- Update documentation

### Quarterly

- Major package updates
- Review and refactor code
- Update architecture docs
- Security audit

## Quick Maintenance Commands

```bash
# Quick health check
npm audit && npm test && npm run build

# Full maintenance
npm outdated && npm audit && npm run lint && npm test && npm run build

# Clean and rebuild
rm -rf node_modules dist && npm install && npm run build
```

## Automated Maintenance Script

Consider creating a maintenance script:

```json
{
  "scripts": {
    "maintain": "npm audit && npm outdated && npm run lint && npm test && npm run build",
    "maintain:full": "npm audit fix && npm update && npm run lint --fix && npm test && npm run build"
  }
}
```

## Best Practices

1. **Regular Maintenance**
   - Schedule regular maintenance sessions
   - Don't let updates accumulate
   - Fix issues promptly

2. **Incremental Updates**
   - Update packages regularly
   - Don't wait for major updates
   - Test after each update

3. **Document Changes**
   - Document maintenance activities
   - Update changelog
   - Note any issues found

4. **Keep Repository Clean**
   - Remove unused code
   - Clean up dependencies
   - Maintain clean git history

5. **Monitor Health**
   - Check logs regularly
   - Monitor test results
   - Review build status

6. **Security First**
   - Fix security issues immediately
   - Review security advisories
   - Keep dependencies current
